script: |
  zc -C -I test.zed
  echo "==="
  zc -s -C -I test.zed

inputs:
  - name: test.zed
    data: |
      func fib(n): (n <= 1 ? n : fib(n-1) + fib(n-2))
      const foo = "bar"
      func add(a,b): (a+b)
      const bar = "baz"
      op stamp(outer, assignee): ( yield {...outer, assignee, ts: now()} )
      op nop(...): ( pass )
      stamp(this, "bob")

outputs:
  - name: stdout
    data: |
      func fib(n): (
        (n<=1) ? n : fib(n-1)+fib(n-2)
      )
      const foo = "bar"
      func add(a, b): (
        a+b
      )
      const bar = "baz"
      op stamp(outer, assignee): (
        yield {...outer,assignee,ts:now()}
      )
      op nop(...): (
        pass
      )
      stamp(this, "bob")
      ===
      reader
      | (
        const foo = "bar"
        const bar = "baz"
        func fib(n): (
          (n<=1) ? n : fib(n-1)+fib(n-2)
        )
        func add(a, b): (
          a+b
        )
        op stamp(outer, assignee): (
          yield {...outer,assignee:assignee,ts:now()}
        )
        op nop(...): (
          pass
        )
        
        stamp(this, "bob")
      )

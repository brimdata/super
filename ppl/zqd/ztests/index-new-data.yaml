script: |
  source services.sh
  zapi -h $ZQD_HOST new -k archivestore testsp >/dev/null
  zapi -h $ZQD_HOST -s testsp index create :ip _path
  zapi -h $ZQD_HOST -s testsp post data.zson >/dev/null
  zapi -h $ZQD_HOST -s testsp index find _path=http | zq -z "drop _log" -
  echo ===
  zapi -h $ZQD_HOST -s testsp index find :ip=127.0.0.3 | zq -z "drop _log" -

inputs:
  - name: services.sh
    source: services.sh
  - name: data.zson
    data: |
      {_path:"conn",ts:1970-01-01T00:00:01Z,orig_h:127.0.0.1}
      {_path:"http",ts:1970-01-01T00:00:01Z,orig_h:127.0.0.1}
      {_path:"conn",ts:1970-01-01T00:00:02Z,orig_h:127.0.0.2}
      {_path:"http",ts:1970-01-01T00:00:02Z,orig_h:127.0.0.3}

outputs:
  - name: stdout
    data: |
      {key:"http",count:2 (uint64),first:1970-01-01T00:00:02Z,last:1970-01-01T00:00:01Z} (=0)
      ===
      {key:127.0.0.3,count:1 (uint64),first:1970-01-01T00:00:02Z,last:1970-01-01T00:00:01Z} (=0)

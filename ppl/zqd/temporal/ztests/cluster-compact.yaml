tag: temporal

env:
  - AWS_DEFAULT_REGION
  - AWS_ACCESS_KEY_ID
  - AWS_SECRET_ACCESS_KEY

script: |
  exec 2>&1
  host=localhost:9867 # service endpoint for zqd root
  space=ZTest_cluster_compact
  zed api -h $host rm $space &>/dev/null || true
  zed api -h $host new -k archivestore $space >/dev/null
  zed api -h $host -s $space post babble.zson >/dev/null
  zed api -h $host -s $space post babble.zson >/dev/null
  # Give the Temporal workflow a chance to run.
  sleep 5
  data_path=$(zed api -h $host ls -l -f zng | zq -f text "name=\"$space\" | cut data_path" -)
  zed lake ls -R $data_path -ranges
  zed api -h $host rm $space >/dev/null

inputs:
  - name: babble.zson
    source: ../../../../testdata/babble.zson
  - name: temporal.sh

outputs:
  - name: stdout
    data: |
      [1587518620062237300-1587513611063914690]
      [1587513592062544400-1587508830068523240]

script: |
  export ZED_LAKE=test
  zed init -q
  zed create -q -seekstride 11B -orderby ts:desc logs
  zed load -use logs -q in.zson
  zq -z test/*/data/*-seek.zng

inputs:
  - name: in.zson
    data: |
      {ts:1970-01-01T00:00:00Z}
      {ts:1970-01-01T00:00:02Z}
      {ts:1970-01-01T00:00:02Z}
      {ts:1970-01-01T00:00:02Z}
      {ts:1970-01-01T00:00:02Z}
      {ts:1970-01-01T00:00:02Z}
      {ts:1970-01-01T00:00:03Z}
      {ts:1970-01-01T00:00:03Z}
      {ts:1970-01-01T00:00:03Z}
      {ts:1970-01-01T00:00:03Z}
      {ts:1970-01-01T00:00:03Z}
      {ts:1970-01-01T00:00:03Z}
      {ts:1970-01-01T00:00:03Z}
      {ts:1970-01-01T00:00:06Z}
      {ts:1970-01-01T00:00:07Z}
      {ts:1970-01-01T00:00:08Z}

#
# Note that this tests that an index is not broken in the middle of
# keys of the same value as that would cause relevant keys to be
# otherwise skipped over.
#
outputs:
  - name: stdout
    data: |
      {from:1970-01-01T00:00:08Z,to:1970-01-01T00:00:06Z,val_off:0(uint64),val_cnt:3(uint64),offset:0(uint64),length:27(uint64)}
      {from:1970-01-01T00:00:03Z,to:1970-01-01T00:00:03Z,val_off:3(uint64),val_cnt:3(uint64),offset:27(uint64),length:35(uint64)}
      {from:1970-01-01T00:00:03Z,to:1970-01-01T00:00:03Z,val_off:6(uint64),val_cnt:3(uint64),offset:62(uint64),length:35(uint64)}
      {from:1970-01-01T00:00:03Z,to:1970-01-01T00:00:02Z,val_off:9(uint64),val_cnt:3(uint64),offset:97(uint64),length:34(uint64)}
      {from:1970-01-01T00:00:02Z,to:1970-01-01T00:00:02Z,val_off:12(uint64),val_cnt:3(uint64),offset:131(uint64),length:32(uint64)}
      {from:1970-01-01T00:00:00Z,to:1970-01-01T00:00:00Z,val_off:15(uint64),val_cnt:1(uint64),offset:163(uint64),length:21(uint64)}

script: |
  source recserv.sh
  echo ===
  curl --header "Content-Type: application/json" -request POST \
    --data '{"addr":"a.b.c:5000","node":"a.b"}' \
    http://$ZQD_HOST/workers/register 2> err
  echo ===
  curl -request GET http://$ZQD_HOST/workers/stats 2> err
  echo ===
  curl --header "Content-Type: application/json" -request POST \
    --data '{"N":1}' \
    http://$ZQD_HOST/workers/recruit 2> err
  echo ===
  curl -request GET http://$ZQD_HOST/workers/stats 2> err
  #
  # For this second register, the worker will be in the reserved pool,
  # so it will not be reregistered.
  #
  echo ===
  curl --header "Content-Type: application/json" -request POST \
    --data '{"addr":"a.b.c:5000","node":"a.b"}' \
    http://$ZQD_HOST/workers/register 2> err
  #
  # unreserve the worker
  #
  echo ===
  curl --header "Content-Type: application/json" -request POST \
    --data '{"addr":"a.b.c:5000"}' \
    http://$ZQD_HOST/workers/unreserve 2> err
  echo ===
  curl --header "Content-Type: application/json" -request POST \
    --data '{"addr":"a.b.c:5000","node":"a.b"}' \
    http://$ZQD_HOST/workers/register 2> err
  echo ===
  curl --header "Content-Type: application/json" -request POST \
    --data '{"addr":"a.b.c:5000"}' \
    http://$ZQD_HOST/workers/deregister 2> err
  echo ===
  curl --header "Content-Type: application/json" -request POST \
    --data '{"N":1}' \
    http://$ZQD_HOST/workers/recruit 2> err

inputs:
  - name: recserv.sh
    source: recserv.sh

outputs:
  - name: stdout
    data: |
      ===
      {"registered":true}
      ===
      {"LenFreePool":1,"LenReservedPool":0,"LenNodePool":1}
      ===
      {"workers":[{"addr":"a.b.c:5000","node":"a.b"}]}
      ===
      {"LenFreePool":0,"LenReservedPool":1,"LenNodePool":0}
      ===
      {"registered":false}
      ===
      {"reserved":false}
      ===
      {"registered":true}
      ===
      {"registered":false}
      ===
      {"workers":[]}

script: |
  # This test is derived from worker-dist.
  # recroot.sh starts a zqd recruiter process
  # (instead of passing a list of workers with ZQD_TEST_WORKERS) 
  #
  source recroot.sh  
  mkdir spacedir
  #
  # This creates a space with a small threshold in order to produce
  # three or more "chunks" in the space
  #
  zapi -h $ZQD_HOST new -k archivestore -d spacedir -thresh 15KB testsp > /dev/null
  #
  # This is the same smtp.log from zq-sample-data
  #
  zapi -h $ZQD_HOST -s testsp post smtp.log.gz > /dev/null
  #
  # The count() from zq should be identical to 
  # the count() from zapi get -chunk
  #
  zq -t "count()" smtp.log.gz > zqcount.tzng
  zapi -h $ZQD_HOST -s testsp get -p 2 -t "count()" > zapicount.tzng
  echo ===
  diff -s zqcount.tzng zapicount.tzng

inputs:
  - name: recroot.sh
    source: recroot.sh
  - name: smtp.log.gz
    source: ../data/smtp.log.gz

outputs:
  - name: stdout
    data: |
      ===
      Files zqcount.tzng and zapicount.tzng are identical

script: zq -z -j types.json "*" in.ndjson

inputs:
  - name: in.ndjson
    data: |
      {"ts":"2017-03-24T19:59:23.306076Z","id.orig_h":"1.1.1.1","id.other_h":"1.1.1.2", "id2": {"orig_h": "2.2.2.1", "other_h": "2.2.2.2"}, "id3": {"orig_h": "2.2.2.1"}, "_path":"http", "uid":"CXY9a54W2dLZwzPXf1"}
  - name: types.json
    data: |
      {
        "pass_unknowns": true,
        "descriptors": {
          "http_log": [
            {
              "name": "_path",
              "type": "string"
            },
            {
              "name": "ts",
              "type": "time"
            },
            {
              "name": "uid",
              "type": "bstring"
            },
            {
              "name": "id",
              "type": [
                {
                  "name": "orig_h",
                  "type": "ip"
                }
               ]
             },
            {
              "name": "id2",
              "type": [
                {
                  "name": "orig_h",
                  "type": "ip"
                }
               ]
             }
            ]
           },
        "rules": [
          {
            "name": "_path",
            "value": "http",
            "descriptor": "http_log"
          }
        ]
      }

outputs:
  - name: stdout
    data: |
      {_path:"http",ts:2017-03-24T19:59:23.306076Z,uid:"CXY9a54W2dLZwzPXf1" (bstring),id:{orig_h:1.1.1.1},id2:{orig_h:2.2.2.1},"id.other_h":"1.1.1.2","id2.other_h":"2.2.2.2","id3.orig_h":"2.2.2.1"} (=0)

spq: fuse

vector: true

input: |
  {a:"hello",b:"world"}
  {b:"goodnight",c:"gracie"}
  {a:"goodnight",b:123::int32}
  {a:null,b:null,c:null}

output: |
  {a:"hello"::(string|null),b:"world"::(int32|string|null),c:null::(string|null)}
  {a:null::(string|null),b:"goodnight"::(int32|string|null),c:"gracie"::(string|null)}
  {a:"goodnight"::(string|null),b:123::int32::(int32|string|null),c:null::(string|null)}
  {a:null::(string|null),b:null::(int32|string|null),c:null::(string|null)}

---

# Test fuse on an array of records.
spq: fuse

vector: true

input: |
  [{a:1}]
  [{b:2}]
  [{a:3},{b:3}]
  [{a:3,b:3}]
  [{a:null,b:null}]

output: |
  [{a:1::(int64|null),b:null::(int64|null)}]
  [{a:null::(int64|null),b:2::(int64|null)}]
  [{a:3::(int64|null),b:null::(int64|null)},{a:null::(int64|null),b:3::(int64|null)}]
  [{a:3::(int64|null),b:3::(int64|null)}]
  [{a:null::(int64|null),b:null::(int64|null)}]

---

# Test fuse on mix of complex and primitive values.
spq: fuse

vector: true

input: |
  {a:1}
  {a:"s"}
  1
  "s"
  [1]
  ["s"]

output: |
  {a:1::(int64|string)}::(int64|string|{a:int64|string}|[int64|string])
  {a:"s"::(int64|string)}::(int64|string|{a:int64|string}|[int64|string])
  1::(int64|string|{a:int64|string}|[int64|string])
  "s"::(int64|string|{a:int64|string}|[int64|string])
  [1]::[int64|string]::(int64|string|{a:int64|string}|[int64|string])
  ["s"]::[int64|string]::(int64|string|{a:int64|string}|[int64|string])

---

# Test fuse on nested records.
spq: fuse

input: |
  {a:"hello",r:{x:1::int32,y:2::int32}}
  {r:{y:4::int32,z:5::int32},s:"world",r2:{x:6::int32}}
  {a:null,r:{x:null,y:null,z:null},s:null,r2:null}

output: |
  {a:"hello"::(string|null),r:{x:1::int32::(int32|null),y:2::int32::(int32|null),z:null::(int32|null)},s:null::(string|null),r2:null::(null|{x:int32})}
  {a:null::(string|null),r:{x:null::(int32|null),y:4::int32::(int32|null),z:5::int32::(int32|null)},s:"world"::(string|null),r2:{x:6::int32}::(null|{x:int32})}
  {a:null::(string|null),r:{x:null::(int32|null),y:null::(int32|null),z:null::(int32|null)},s:null::(string|null),r2:null::(null|{x:int32})}

---

spq: fuse

vector: true

input: |
  error(1)
  error("s")

output: |
  error(1::(int64|string))
  error("s"::(int64|string))

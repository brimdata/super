spq: "collect_map(|{stock: price}|)"

output-flags: -pretty 2

input: |
  {stock:"APPL",price:150.94}
  {stock:"GOOG",price:91.22}
  {stock:"APPL",price:160.94}
  {stock:"SBUX",price:87.30}
  {stock:"NKE",price:94.12}
  {stock:"TMUS",price:152.22}

output: |
  |{
    "NKE": 94.12,
    "APPL": 160.94,
    "GOOG": 91.22,
    "SBUX": 87.3,
    "TMUS": 152.22
  }|

---

# Test union values
spq: "collect_map(|{k:v}|)"

output-flags: -pretty 2

input: |
  // Named type and union type.
  {k:"foo"::=my_string,v:"bar"::(int64|string)}
  // Named union type.
  {k:1::my_union=int32|int64,v:1}
  {k:127.0.0.1,v:127.0.0.1}
  {k:2.,v:2.}
  {k:["bar","baz"],v:["bar","baz"]}

output: |
  |{
    1: 1,
    "foo"::=my_string: "bar",
    127.0.0.1: 127.0.0.1,
    2.: 2.,
    [
      "bar",
      "baz"
    ]: [
      "bar",
      "baz"
    ]
  }|

---

# Test partials
script: |
  super -s -c 'collect_map(|{key:val}|) with -limit 1' in.sup

vector: true

inputs:
  - name: in.sup
    data: |
      {key:"k1",val:"v1"}
      {key:"k2",val:"v1"}

outputs:
  - name: stdout
    data: |
      |{"k1":"v1","k2":"v1"}|

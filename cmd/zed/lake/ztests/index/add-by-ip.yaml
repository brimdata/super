script: |
  export ZED_LAKE_ROOT=test
  zed lake init -q
  zed lake create -q test
  id=$(zed lake load -use test@main in.zson | awk '{print $1}')
  zed lake index create -q IPs type ip
  zed lake index apply -use test@main IPs $id
  echo ===
  zed lake query -Z "from test@main:rawlog | cut this:=object.Rule | drop id,ts"

inputs:
  - name: in.zson
    data: |
      {x:127.0.0.1}
      {x:127.0.0.2}

outputs:
  - name: stdout
    regexp: |
      \w{27} committed
      ===
      \{
          name: "IPs",
          type: "ip"
      \}

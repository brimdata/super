script: |
  export AWS_REGION=us-east-2 AWS_ACCESS_KEY_ID=minioadmin \
        AWS_SECRET_ACCESS_KEY=minioadmin AWS_S3_ENDPOINT=http://localhost:9000
  mkdir -p data/bucket
  minio server --quiet --address "localhost:9000" ./data &> /dev/null &
  pid=$!
  until nc -vzw 2 localhost 9000; do sleep 2; done
  zar import -s 20KiB -R ./root -data s3://bucket/zartest babble.tzng
  echo ===
  zar ls -R ./root
  echo ===
  zar ls -relative -R ./root
  kill -KILL $pid &> /dev/null

inputs:
  - name: babble.tzng
    source: ../../zdx/babble.tzng

outputs:
  - name: stdout
    data: |
      ===
      s3://bucket/zartest/20200422/1587518620.0622373.zng.zar
      s3://bucket/zartest/20200421/1587512288.06249439.zng.zar
      ===
      20200422/1587518620.0622373.zng.zar
      20200421/1587512288.06249439.zng.zar

script: |
  source service.sh
  zapi create -q p1
  zapi create -q p2
  zapi create -q p3
  zapi drop -f p3
  echo === | tee /dev/stderr
  zapi ls -f zng | zq -z "pick name | sort name" -
  echo === | tee /dev/stderr
  ! zapi drop p3
  ! zapi -lake http://localhost:1 drop p3

inputs:
  - name: service.sh
    source: service.sh

outputs:
  - name: stdout
    data: |
      pool deleted: p3
      ===
      {name:"p1"}
      {name:"p2"}
      ===
  - name: stderr
    data: |
      ===
      ===
      "p3": pool not found
      Post "http://localhost:1/query": dial tcp [::1]:1: connect: connection refused

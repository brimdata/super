script: |
  source service.sh
  curl -X POST \
    -H "Accept: application/json" \
    -d '{"name": "test", "layout": { "order": "desc", "keys": [["ts"]] }}' \
    $ZED_LAKE/pool > /dev/null
  curl -X PUT \
    -H "Accept: application/json" \
    -d '{"name":"new_test"}' \
    $ZED_LAKE/pool/test
  curl -X POST \
    -H "Accept: application/json" \
    -d '{"query":"from :pools"}' \
    $ZED_LAKE/query | zq -Z "yield this[0] | value.id.value:=0,value.ts:=0" -

inputs:
  - name: service.sh

outputs:
  - name: stdout
    data: |
      {
          kind: "pools.Config",
          value: {
              id: {
                  kind: "ksuid.KSUID",
                  value: 0
              },
              layout: {
                  kind: "order.Layout",
                  value: {
                      keys: {
                          kind: "field.List",
                          value: [
                              {
                                  kind: "field.Path",
                                  value: [
                                      "ts"
                                  ]
                              }
                          ]
                      },
                      order: {
                          kind: "order.Which",
                          value: "desc"
                      }
                  }
              },
              name: "new_test",
              seek_stride: 65536,
              threshold: 524288000,
              ts: 0
          }
      }

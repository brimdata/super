script: |
  source service.sh
  curl -X POST -d '{"name":"test"}' http://$ZED_LAKE_HOST/pool > pool.json
  poolID=$(zq -f text 'cut value.id' pool.json)
  curl -X POST -d @- http://$ZED_LAKE_HOST/pool/$poolID/add > add.json
  commitID=$(zq -f text 'cut value.commit' add.json)
  curl -X POST -d '{}' http://$ZED_LAKE_HOST/pool/$poolID/staging/$commitID
  curl http://$ZED_LAKE_HOST/pool/$poolID/stats

inputs:
  - name: stdin
    source: ../../testdata/babble.zson
  - name: service.sh

outputs:
  - name: stdout
    data: |
      {"kind":"PoolStats","value":{"size":34374,"span":{"dur":9789993714061,"ts":"2020-04-21T22:40:30.06852324Z"}}}

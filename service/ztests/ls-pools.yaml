script: |
  source service.sh
  zapi create p1
  zapi create p2
  echo ===

  # Verify that the default output format is text of names only.
  zapi ls | sort
  echo ===

  # Verify that output flags are honored.
  zapi ls -f zson | zq -i zson -f zson "pick name | sort name" -
  echo ===
  zapi ls -f zng | zq -i zng -f table "pick name | sort name" -
  echo ===

inputs:
  - name: service.sh
    source: service.sh

outputs:
  - name: stdout
    regexp: |
      pool created: p1 \w{27}
      pool created: p2 \w{27}
      ===
      p1 \w{27} key ts order desc
      p2 \w{27} key ts order desc
      ===
      {
          name: "p1"
      }
      {
          name: "p2"
      }
      ===
      name
      p1
      p2
      ===
